/*
	Wel!Amazon Adds for Wordpress v1.2
	Copyright 2010  Knut Welzel www.welzels.de (email : admin@welzels.de)
	
	This program is free software; you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation; either version 2 of the License, or
	(at your option) any later version.
	
	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.

	You should have received a copy of the GNU General Public License
	along with this program; if not, write to the Free Software
	Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
*/

(function(WAA){WAA(document).ready(function(){var get=WAA('#WAA_interim').attr('src').split('?');var webSrv=get[0].replace(/images\/empty.png/,'waa-webservice.php');var env=WAA.toObject(get[1]);WAA.each(WAA('iframe.WAA_enhanced'),function(i,el){var elQ=WAA(el);var asin=elQ.attr('title');if(asin){elQ.css('position','relative','visibility','hidden');var align=WAA.isArray(align=elQ.attr('class').match(/align.*/))?align[0]:'';var asins=asin.split(',');var src=elQ.attr('src').split('?');var href=src[0];var left=elQ.position().left;var top=elQ.position().top;elQ.wrap('<div class="'+align+'" id="WAA_iframe_container_'+i+'" style="position:relative;width:'+elQ.innerWidth()+'px;height:'+elQ.innerHeight()+'px;">');objQ=WAA('#WAA_iframe_container_'+i);elQ.css('visibility','hidden');elS=objQ.html();WAA.each(asins,function(j,e){var data=WAA.map(src[1].split('&'),function(a,i){var v=a.split('=');if(v[0]=='asins')a=v[0]+"="+e;return a}).join('&');var newEl=WAA(elS.replace(/\?(.*?)"/,'?'+data+'"')).appendTo(objQ);newEl.removeClass(align).css({'position':'absolute','margin':'0px','left':'0px','top':'0px','visibility':'visible'})[j>0?'hide':'show']().addClass('WAA_enhanced_'+i)});window.setInterval(function(){WAA('.WAA_enhanced_'+i).toggleFade(2000)},10000)}});var image=WAA('.WAA_image img');WAA.each(image,function(i,el){if(this.complete){window.setTimeout(function(){WAA.setupImage(el,i)},50)}else{WAA(el).load(function(){WAA.setupImage(el,i)})}})});WAA.setupImage=function(el,i){var elQ=WAA(el);var asin=elQ.parent().attr('type');var align=WAA.isArray(align=elQ.attr('class').match(/align.*/))?align[0]:'';var get=WAA('#WAA_interim').attr('src').split('?');var webSrv=get[0].replace(/images\/empty.png/,'waa-webservice.php');var env=WAA.toObject(get[1]);elQ.parent().wrap('<div class="WAA_loading '+align+'" id="WAA_img_container_'+i+'">');WAA('#WAA_img_container_'+i).css({'position':'relative','height':elQ.outerHeight()+'px','width':elQ.outerWidth()+'px','overflow':'hidden'});if(asin){if(asin.match(/,/)){var asins=asin.split(',');var rndAsin=asins[Math.round((asins.length-1)*Math.random())];var d={type:'image',asin:rndAsin,waa_nonce:env.n,size:waaImageSize(el.src)};WAA.ajax({type:'POST',url:webSrv,data:WAA.param(d),dataType:'html',success:function(r){var width=r.match(/width="(.*?)"/i)[1];var height=r.match(/height="(.*?)"/i)[1];var sty=elQ.attr('style');var css=elQ.attr('class');(elQ.parent().parent().html(r).children().children()).addClass(css).attr('style',sty).css({'visibility':'visible','display':'none','width':width+'px','height':height+'px'}).fadeIn('slow')}})}else if(asin.match(/;/)){var asins=asin.split(';');var s=waaImageSize(elQ.attr('src'));WAA.each(asins,function(j,e){var d={type:'image',waa_nonce:env.n,size:s,asin:e,id:'WAA_img_container_'+i,count:asins.length-1};WAA.ajax({type:'POST',url:webSrv,data:WAA.param(d),dataType:'html',success:function(r){var width=r.match(/width="(.*?)"/i)[1];var height=r.match(/height="(.*?)"/i)[1];var elQ=WAA('#'+d.id+' a img').first();var newEl=WAA(r).appendTo(WAA('#'+d.id));var sty=elQ.attr('style')?elQ.attr('style'):'';WAA('#'+d.id+' a img').last().addClass(elQ.attr('class')).attr('style',sty).css({'position':'absolute','margin':'0px','top':((elQ.height()-height)/2)+'px','left':((elQ.width()-width)/2)+'px','visibility':'visible'}).hide();if(j==0){WAA('#'+d.id).children().last().children().fadeIn('slow')}if(j==(d.count)){WAA('#'+d.id).children().first().remove();WAA('#'+d.id).removeClass('WAA_loading');window.setInterval(function(){WAA('#'+d.id+' a img').toggleFade(2000)},10000)}}})})}}else{elQ.css({'visibility':'visible','width':el.width+'px','height':el.height+'px'})}function waaImageSize(src){if(src.match(/_SL75_/))return'small';else if(src.match(/_SL30_/))return'swatch';else if(src.match(/_SL110_/))return'tiny';else if(src.match(/_SL160_/))return'medium';else return'large'}};WAA.fn.toggleFade=function(options){var nxt,cur=this.lenght-1;if(typeof options=='object')settings=WAA.extend({speedIn:'slow',speedOut:'slow'},options);else settings=WAA.extend({speedIn:options,speedOut:options});this.each(function(i,e){if(!WAA(this).is(":hidden"))cur=i});nxt=(cur<this.length-1)?(cur+1):0;WAA(this[cur]).fadeOut(settings.speedOut);WAA(this[nxt]).fadeIn(settings.speedIn);return this};WAA.toObject=function(array){var obj={};WAA.map(array.split('&'),function(a,i){var e=unescape(a).split('=');var k=e[0];var v=(e[1]?e[1]:null);obj[k]=v});return obj}})(jQuery);
